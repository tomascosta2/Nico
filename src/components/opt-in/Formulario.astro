<section class="py-[60px] md:py-[80px]">
	<div class="max-w-[1040px] mx-auto px-4">
		<span class="text-white bg-[#151F57] py-[10px] mb-8 px-8 border-white/30 border-3 rounded-full block w-fit mx-auto">
			Obtene la Masterclass ahora
		</span>
		<h3
			class="text-[#FFF] font-semibold text-[28px] text-center md:text-[32px] mb-8 max-w-[820px] mx-auto leading-[120%]"
		>
		REGISTRATE AHORA EN LA MASTERCLASS y llena tus clases de yoga
		</h3>
		<div class="grid md:grid-cols-2 gap-8">
			<div>
				<div
					class="bg-[#151F57] rounded-lg px-[16px] py-[64px] md:p-[72px] overflow-clip relative max-w-full"
				>
					<div class="md:w-[380px] max-w-full mx-auto relative">
						<form action="" id="webhookForm">
							<label
								for="email"
								class="text-[#fff] font-medium mb-4 block"
							>
								Tu correo electronico
								<input
									type="email"
									name="email"
									placeholder="yogateacher@gmail.com"
									class="w-full p-[16px] rounded-[6px] bg-[#fff] mt-2 text-[#111]/60 placeholder:text-[14px] font-normal"
								/>
							</label>
							<label
								for="phone"
								class="text-[#fff] font-medium block"
							>
								Tu nÃºmero de WhatsApp
								<div class="flex gap-2 mt-2">
									<select
										name="countryCode"
										id="countryCode"
										class="p-[16px] rounded-[6px] bg-[#fff] text-[#111]/80 font-normal"
									>
										<option value="+54">ðŸ‡¦ðŸ‡· AR</option>
										<option value="+56">ðŸ‡¨ðŸ‡± CL</option>
										<option value="+57">ðŸ‡¨ðŸ‡´ CO</option>
										<option value="+52">ðŸ‡²ðŸ‡½ MX</option>
									</select>
									<input
										type="tel"
										name="phone"
										id="phoneInput"
										placeholder="2616841853"
										class="w-full p-[16px] rounded-[6px] bg-[#fff] text-[#111]/60 placeholder:text-[14px] font-normal"
									/>
								</div>
							</label>
							<button
								type="submit"
								class="bg-[#FF904D] px-6 py-4 text-white font-semibold rounded-sm mx-auto block w-full cursor-pointer mt-6"
							>
								Â¡Quiero asistir a la Masterclas Gratuita!
							</button>
						</form>
					</div>
				</div>
			</div>
			<div class="md:py-8 max-w-full">
				<p class="mb-4 font-semibold text-white">
					De esta Masterclass te vas a llevar:
				</p>
				<ul class="list-inside text-white">
					<li class="mb-4 flex gap-2">
						<svg
							class="size-[20px] min-w-[20px]"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 448 512"
							fill="#FF904D"
							><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
							<path
								d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
							></path></svg
						>
						Absoluta claridad de por donde NO es tu camino.
					</li>
					<li class="mb-4 flex gap-2">
						<svg
							class="size-[20px] min-w-[20px]"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 448 512"
							fill="#FF904D"
							><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
							<path
								d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
							></path></svg
						>
						Descubrir la diferencia entre yoga teachers que tienen salas llenas vs vacÃ­as.
					</li>
					<li class="mb-4 flex gap-2">
						<svg
							class="size-[20px] min-w-[20px]"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 448 512"
							fill="#FF904D"
							><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
							<path
								d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
							></path></svg
						>
						Lo que nadie te dice acerca de vivir de tus clases.
					</li>
					<li class="mb-4 flex gap-2">
						<svg
							class="size-[20px] min-w-[20px]"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 448 512"
							fill="#FF904D"
							><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
							<path
								d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
							></path></svg
						>
						Descubrir secretos y tips prÃ¡cticos para desarrollar tu carrera como yoga Teacher.
					</li>
				</ul>
			</div>
		</div>
	</div>
</section>

<script>

	document
		.querySelectorAll<HTMLFormElement>("#webhookForm")
		.forEach((form) => {
			form.addEventListener("submit", async function (event) {
				event.preventDefault();

				const formData = new FormData(this);
				const data = Object.fromEntries(formData.entries());

				console.log(data)
				sendConversion(data);

				try {
					const response = await fetch(
						"https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjYwNTY4MDYzNjA0MzE1MjZmNTUzZDUxMzIi_pc",
						{
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(data),
						},
					);

					if (response.ok) {
						window.location.href = "/masterclass/thankyou";
					} else {
						alert("Error al enviar el formulario.");
					}
				} catch (error) {
					alert("Hubo un problema al enviar los datos.");
				}
			});
		});

		const sendConversion = async (data: any) => {

			console.log("DATA: ", data.email)

			const hashEmail = await hashSHA256(data.email);
			const hashPhone = await hashSHA256(data.phone);

			const response = await fetch('https://graph.facebook.com/v18.0/942814494324978/events?access_token=EAAHvSFD2EsUBO8ZCBsV5ZAZCZBkKboxUQ7XTHwRQk503NiaWJDfvDVZBoEmU4L0TUnCYng5KUhwBfvZC20ECUIceKDtsAg5E0ewp5J1ZADmiWqrliNlNxJK3OCkYKV6PnsI0EeFrTdG2HCYICANmymCIEZCtb19kkf4ylM0dTbbIGZAfJStG4yDdNW4OcXIZAWQRUGYwZDZD', {
				method: 'POST',
				headers: {
				'Content-Type': 'application/json'
				},
				body: JSON.stringify({
				data: [
					{
					event_name: "Lead",
					event_time: Math.floor(Date.now() / 1000), // tiempo actual en segundos
					action_source: "website",
					user_data: {
						em: [hashEmail],
						ph: [hashPhone] 
					},
					original_event_data: {
						event_name: "Lead",
						event_time: Math.floor(Date.now() / 1000)
					}
					}
				]
				})
			});

			const result = await response.json();
			console.log(result);
		};

		async function hashSHA256(value: String) {
			const encoder = new TextEncoder();
			const data = encoder.encode(value.trim().toLowerCase()); // sin espacios, en minÃºsculas
			const hashBuffer = await crypto.subtle.digest('SHA-256', data);
			const hashArray = Array.from(new Uint8Array(hashBuffer));
			return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
		}
</script>
